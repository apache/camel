[[hwcloud-image-recognitioncomponent]]
= Huawei Cloud Image Recognition Component
:docTitle: Huawei Cloud Image Recognition
:artifactId: camel-huaweicloud-imagerecognition
:description: Image Recognition uses deep learning technologies to accurately identify objects, scenes, and concepts in images using a pool of visual content tags.
:since: 3.12
:supportLevel: Stable
:component-header: Only producer is supported
include::{cq-version}@camel-quarkus:ROOT:partial$reference/components/hwcloud-imagerecognition.adoc[opts=optional]
//Manually maintained attributes
:group: Huawei Cloud

*Since Camel {since}*

*{component-header}*

Huawei Cloud Image Recognition component allows you to integrate with https://www.huaweicloud.com/intl/en-us/product/image.html[Image Recognition] provided by Huawei Cloud.

Maven users will need to add the following dependency to their `pom.xml`
for this component:

[source,xml]
------------------------------------------------------------
<dependency>
    <groupId>org.apache.camel</groupId>
    <artifactId>camel-huaweicloud-imagerecognition</artifactId>
    <version>x.x.x</version>
    <!-- use the same version as your Camel core version -->
</dependency>
------------------------------------------------------------

== URI format

To send a notification.

[source,java]
------------------------
hwcloud-image:operation[?options]
------------------------

== Options

// component options: START
The Huawei Cloud Image Recognition component supports 2 options, which are listed below.

[width="100%",cols="2,5,^1,2",options="header"]
|===
| Name | Description | Default | Type
| *lazyStartProducer* (producer) | Whether the producer should be started lazy (on the first message).
By starting lazy you can use this to allow CamelContext and routes to startup in situations where a producer may otherwise fail during starting and cause the route to fail being started.
By deferring this startup to be lazy then the startup failure can be handled during routing messages via Camel's routing error handlers.
Beware that when the first message is processed then creating and starting the producer may take a little time and prolong the total processing time of the processing. | false | boolean
| *autowiredEnabled* (advanced) | Whether autowiring is enabled.
This is used for automatic autowiring options (the option must be marked as autowired) by looking up in the registry to find if there is a single instance of matching type, which then gets configured on the component.
This can be used for automatic configuring JDBC data sources, JMS connection factories, AWS Clients, etc. | true | boolean
|===
// component options: END

// endpoint options: START
The Huawei Cloud Image Recognition endpoint is configured using URI syntax:

----
hwcloud-image:operation
----

with the following path and query parameters:

=== Path Parameters (1 parameters):

[width="100%",cols="2,5,^1,2",options="header"]
|===
| Name | Description | Default | Type
| *operation* | *Required* Name of image recofnition operation, including tagRecognition and celebrityRecognition |  | String
|===

=== Query Parameters (16 parameters):

[width="100%",cols="2,5,^1,2",options="header"]
|===
| Name | Description | Default | Type
| *accessKey* (producer) | *Required* Access key for the cloud user |  | String
| *secretKey* (producer) | *Required* Secret key for the cloud user |  | String
| *serviceKeys* (producer) | Configuration object for cloud service authentication |  | ServiceKeys
| *projectId* (producer) | *Required* Cloud project ID |  | String
| *endpoint* (producer) | Fully qualified Image Recognition service url.
Carries higher precedence than region based configuration |  | String
| *region* (producer) | Image Recognition service region.
Currently only cn-north-1 and cn-north-4 are supported.
This is lower precedence than endpoint based configuration |  | String
| *ignoreSslVerification* (producer) | Ignore SSL verification | false | boolean
| *proxyHost* (producer) | Proxy server ip/hostname |  | String
| *proxyPassword* (producer) | Proxy authentication password |  | String
| *proxyPort* (producer) | Proxy server port |  | int
| *proxyUser* (producer) | Proxy authentication user |  | String
| *imageContent* (producer) | "Indicates the Base64 character string converted from the image.
The image size cannot exceed 10 MB and image resolution of the narrow sides must be greater than 15 pixels, and that of the wide sides cannot exceed 4096 pixels.
The supported image formats include JPG, PNG, and BMP. Configure either this parameter or imageUrl.
Configure either this parameter or imageUrl, and this one carries higher precedence than imageUrl" |  | String
| *imageUrl* (producer) | "Indicates the URL of an image.
The options are as follows:
HTTP/HTTPS URLs on the public network OBS URLs.
To use OBS data, authorization is required, including service authorization, temporary authorization, and anonymous public authorization.
For details, see Configuring the Access Permission of OBS.
Configure either this parameter or imageContent, and this one carries lower precedence than imageContent.
" |  | String
| *tagLanguage* (producer) | Indicates the language of the returned tags when the operation is tagRecognition, including zh and en |  | String
| *tagLimit* (producer) | Indicates the maximum number of the returned tags when the operation is tagRecognition |  | int
| *threshold* (producer) | Indicates the threshold of confidence.
When the operation is tagRecognition, this parameter ranges from 0 to 100. Tags whose confidence score is lower than the threshold will not be returned.
The default value is 60.
When the operation is celebrityRecognition, this parameter ranges from 0 to 1. Labels whose confidence score is lower than the threshold will not be returned.
The default value is 0.48.|  | int
|===
// endpoint options: END

[NOTE]
====
When using imageContent option, we suggest you use RAW(image_base64_value) to avoid encoding issue.
====

== Usage

=== Message properties evaluated by the Image Recognition producer

[width="100%",cols="10%,10%,80%",options="header",]
|=======================================================================
|Header |Type |Description

|`CamelHwCloudImageContent` |`String` |The Base64 character string converted from the image

|`CamelHwCloudImageUrl` |`String` |The URL of an image

|`CamelHwCloudImageTagLimit` |`Integer` |The maximum number of the returned tags when the operation is tagRecognition

|`CamelHwCloudImageTagLanguage` |`String` |The language of the returned tags when the operation is tagRecognition

|`CamelHwCloudImageThreshold` |`Integer` |The threshold of confidence.


|=======================================================================

== List of Supported Image Recognition Operations

- celebrityRecognition - to analyze and identify the political figures, stars and online celebrities contained in the picture, and return the person information and face coordinates
- tagRecognition - to recognize hundreds of scenes and thousands of objects and their properties in natural images

== Inline Configuration of route

=== celebrityRecognition

Java DSL

[source,java]
--------------------------------------------------------------------------------
from("direct:triggerRoute")
.setProperty(ImageRecognitionProperties.IMAGE_URL, constant("https://xxxx"))
.setProperty(ImageRecognitionProperties.THRESHOLD,constant(0.5))
.to("hwcloud-image:celebrityRecognition?accessKey=*********&secretKey=********&projectId=9071a38e7f6a4ba7b7bcbeb7d4ea6efc&region=cn-north-4")
--------------------------------------------------------------------------------

XML DSL

[source,xml]
--------------------------------------------------------------------------------
<route>
   <from uri="direct:triggerRoute" />
   <setProperty name="CamelHwCloudImageUrl">
      <constant>https://xxxx</constant>
   </setProperty>
   <setProperty name="CamelHwCloudImageThreshold">
      <constant>0.5</constant>
   </setProperty>
   <to uri="hwcloud-image:celebrityRecognition?accessKey=*********&amp;secretKey=********&amp;projectId=9071a38e7f6a4ba7b7bcbeb7d4ea6efc&amp;region=cn-north-4" />
</route>
--------------------------------------------------------------------------------

=== tagRecognition

Java DSL

[source,java]
--------------------------------------------------------------------------------
from("direct:triggerRoute")
.setProperty(ImageRecognitionProperties.IMAGE_CONTENT, constant("/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAA0JCgsKCA0LCgsODg0PEyAVExISEyccHhcgLikxMC4pLSwzOko+MzZGNywtQFdBRkxOUlNSMj5aYVpQYEpRUk//..."))
.setProperty(ImageRecognitionProperties.THRESHOLD,constant(60))
.setProperty(ImageRecognitionProperties.TAG_LANGUAGE,constant("en"))
.setProperty(ImageRecognitionProperties.TAG_LIMIT,constant(50))
.to("hwcloud-image:tagRecognition?accessKey=*********&secretKey=********&projectId=9071a38e7f6a4ba7b7bcbeb7d4ea6efc&region=cn-north-4")
--------------------------------------------------------------------------------

XML DSL

[source,xml]
--------------------------------------------------------------------------------
<route>
    <from uri="direct:triggerRoute" />
    <setProperty name="CamelHwCloudImageContent">
        <constant>/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAA0JCgsKCA0LCgsODg0PEyAVExISEyccHhcgLikxMC4pLSwzOko+MzZGNywtQFdBRkxOUlNSMj5aYVpQYEpRUk//...</constant>
    </setProperty>
    <setProperty name="CamelHwCloudImageThreshold">
        <constant>60</constant>
    </setProperty>
    <setProperty name="CamelHwCloudImageTagLanguage">
        <constant>en</constant>
    </setProperty>
    <setProperty name="CamelHwCloudImageTagLimit">
        <constant>50</constant>
    </setProperty>
    <to uri="hwcloud-image:tagRecognition?accessKey=*********&amp;secretKey=********&amp;projectId=9071a38e7f6a4ba7b7bcbeb7d4ea6efc&amp;region=cn-north-4" />
</route>
--------------------------------------------------------------------------------