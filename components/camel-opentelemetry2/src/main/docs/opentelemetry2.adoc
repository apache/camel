= Opentelemetry2 Component
:doctitle: Opentelemetry2
:shortname: opentelemetry2
:artifactid: camel-opentelemetry2
:description: Implementation of Camel Opentelemetry based on the Camel Telemetry spec
:since: 4.11
:supportlevel: Preview
:tabs-sync-option:

*Since Camel {since}*

This module is the implementation of the common `camel-telemetry` interface based on https://opentelemetry.io/[OpenTelemetry] technology. The name used here as `camel-opentelemetry2` is done to distinguish on the existing `camel-opentelemetry` which was based on an older Camel tracing specification. You're invited to start replacing the older `camel-opentelemetry` with this one instead as it may become the default component in future version of Camel.

NOTE: this component has slight differences compared to the `camel-openetelemetry` and is meant to solve a few inconsistencies identified.

== Configuration

The configuration properties for the OpenTelemetry2 tracer are:

[width="100%",cols="10%,10%,80%",options="header",]
|=======================================================================
|Option |Default |Description
|`excludePatterns` |  | Sets exclude pattern(s) that will disable tracing for Camel
messages that matches the pattern. The content is a Set<String> where the key is a pattern. The pattern
uses the rules from Intercept.
|`traceProcessors` | `false` | Setting this to true will create new OpenTelemetry Spans for each Camel Processors.
Use the excludePattern property to filter out Processors
|=======================================================================

=== Using with standalone Camel

If you use `camel-main` as standalone Camel, then you can enable and use OpenTelemetry without Java code.

Add `camel-opentelemetry2` component in your POM, and configure in `application.properties`:

[source,properties]
----
camel.opentelemetry2.enabled = true
# you can configure the other options
# camel.opentelemetry2.traceProcessors = true
----

When starting the application, you may need to configure a few OpenTelemetry SDK variables, as you can see in te following example:

```bash
$ java -Dotel.metrics.exporter=none -Dotel.logs.exporter=none -jar my-app.jar
```

[[OpenTelemetry-JavaAgent]]
=== Java Agent

Your application will require a Java agent in order to get the traces generated by the Camel application and push to the tracing server.

NOTE: certain runtimes (ie, Quarkus) may provide an inner client which pushes traces to the server. Make sure to read each specific Camel runtime documentation.

Download the https://github.com/open-telemetry/opentelemetry-java-instrumentation/releases/[latest version].

This package includes the instrumentation agent as well as instrumentation for all supported libraries and all available data exporters. The package provides a completely automatic, out-of-the-box experience. Enable the instrumentation agent using the `-javaagent` flag to the JVM.

[source,bash]
----
java -javaagent:path/to/opentelemetry-javaagent.jar \
     -Dotel. ... \
     -jar myapp.jar
----

By default, the OpenTelemetry Java agent uses https://github.com/open-telemetry/opentelemetry-java/tree/main/exporters/otlp[OTLP exporter] configured to send data to https://github.com/open-telemetry/opentelemetry-collector/blob/main/receiver/otlpreceiver/README.md[OpenTelemetry collector] at `http://localhost:4318`.

Configuration parameters are passed as Java system properties (`-D` flags) or as environment variables. See https://github.com/open-telemetry/opentelemetry-java-instrumentation/blob/main/docs/agent-config.md[the configuration documentation] for the full list of configuration items. For example:

[source,bash]
----
java -javaagent:path/to/opentelemetry-javaagent.jar \
     -Dotel.service.name=your-service-name \
     -Dotel.traces.exporter=otlp \
     -jar myapp.jar
----

[[OpenTelemetry-Collection]]
=== Collect OpenTelemetry traces

OpenTelemetry is a tracing protocol which is implemented by several vendors. You can use the Jaeger project which provides an open source all in one tracing application. See details how to run it in https://www.jaegertracing.io/docs/latest/getting-started/[Jaeger getting started guide].
